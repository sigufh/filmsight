# FilmTracker 功能清单

## ✅ 已完成功能

### 1. 核心图像处理（C++ / NDK）

#### 基础色调调整
- ✅ 曝光（EV 调整）
- ✅ 对比度
- ✅ 高光/阴影（平滑曲线调整）
- ✅ 白场/黑场
- ✅ 清晰度（局部对比度）
- ✅ 自然饱和度（Vibrance）

#### 色调曲线
- ✅ RGB 总曲线（16 控制点，Catmull-Rom 插值）
- ✅ 单通道曲线（R/G/B 独立）
- ✅ 在线性域实现，无 LUT

#### HSL 调整
- ✅ 8 个色相段（红、橙、黄、绿、青、蓝、紫、品红）
- ✅ 每个色相段独立调整：
  - 色相偏移（-180° 到 +180°）
  - 饱和度（-100% 到 +100%）
  - 亮度（-100% 到 +100%）

#### 胶片模拟
- ✅ 颜色猜色矩阵（非对角，模拟胶片串扰）
- ✅ 通道独立响应曲线（Toe/Linear/Shoulder）
- ✅ 泊松颗粒模型（与 ISO 耦合）

### 2. AI 美颜模块

#### 分析功能
- ✅ 人脸检测（接口已实现，可集成 ML Kit）
- ✅ 皮肤区域检测
- ✅ 图像特征分析（亮度、对比度、肤色）

#### 参数建议
- ✅ 皮肤平滑强度
- ✅ 肤色修正（冷暖调整）
- ✅ 眼部增强（亮度、对比度）
- ✅ 嘴唇增强（饱和度、亮度）
- ✅ 整体人像优化（曝光、对比度、自然饱和度）

#### 自动应用
- ✅ 美颜建议自动转换为 FilmParams
- ✅ 通过 HSL 调整实现肤色修正
- ✅ 通过基础色调实现整体优化

### 3. UI 界面（Kotlin / Compose）

#### 参数控制
- ✅ 基础色调滑块（曝光、对比度、高光、阴影等）
- ✅ 响应曲线控制（可扩展）
- ✅ HSL 调整面板（可扩展）
- ✅ 颗粒控制

#### 美颜面板
- ✅ AI 分析按钮
- ✅ 建议展示
- ✅ 一键应用功能

### 4. 架构完整性

- ✅ C++ 核心算法（线性域处理）
- ✅ JNI 桥接层（完整参数传递）
- ✅ Kotlin Native 封装
- ✅ 数据模型同步（C++ ↔ Kotlin）
- ✅ UI 绑定（Compose 响应式）

## 🚧 待完善功能

### 1. RAW 解码（当前为占位实现）

**需要集成**：
- libraw 库
- 或 Adobe DNG SDK

**当前状态**：
- 接口已定义
- 占位实现可编译运行
- 需要替换为真实解码

### 2. Bayer 去马赛克（当前为简化实现）

**需要实现**：
- 完整的 AHD（Adaptive Homogeneity-Directed）算法
- 或 Malvar 算法

**当前状态**：
- 接口已定义
- 简化实现（直接复制像素）
- 需要替换为真实算法

### 3. AI 模型集成

**需要集成**：
- TFLite 或 ONNX 模型（<5MB）
- 人脸检测模型
- 皮肤检测模型
- 美颜参数预测模型

**当前状态**：
- 接口已定义
- 基于规则的占位实现
- 可编译运行，但需要真实模型

### 4. UI 扩展

**待添加**：
- 曲线编辑器（可视化拖拽）
- HSL 色相段选择器（可视化色轮）
- 局部调整工具（基于掩膜）
- 参数预设管理
- A/B 对比功能

**当前状态**：
- 基础滑块已实现
- 需要更丰富的交互组件

### 5. 性能优化

**待优化**：
- SIMD 向量化（部分已启用）
- 多线程并行处理
- 预览模式（低分辨率快速反馈）
- 内存优化

## 📋 技术栈

### C++ 层
- C++17
- NDK r25c+
- CMake 3.22.1+
- SIMD（AVX2/FMA）

### Kotlin 层
- Kotlin 1.9.20
- Jetpack Compose
- Material 3
- Coroutines

### AI 层（待集成）
- TensorFlow Lite（推荐）
- 或 ONNX Runtime
- ML Kit（人脸检测）

## 🎯 下一步开发重点

1. **集成真实 RAW 解码库**
   - 评估 libraw vs DNG SDK
   - 集成到现有接口

2. **实现完整去马赛克算法**
   - AHD 算法实现
   - 性能优化

3. **集成 AI 模型**
   - 训练/获取轻量模型
   - 集成 TFLite
   - 优化推理速度

4. **完善 UI**
   - 曲线编辑器
   - HSL 可视化
   - 更好的交互体验

5. **性能优化**
   - 多线程处理
   - SIMD 优化
   - 内存管理

## 📊 代码统计

- **C++ 核心算法**：~2000 行
- **Kotlin UI 和业务逻辑**：~1500 行
- **JNI 桥接**：~300 行
- **总计**：~3800 行

## 🔒 核心约束遵守情况

✅ **RAW 优先**：所有计算在线性域  
✅ **模型先于结果**：模拟物理过程  
✅ **AI 辅助**：只输出参数建议  
✅ **离线可用**：无网络依赖  
✅ **可解释性**：所有参数可调、可理解
